from keys import Keys 
import httplib

keys = Keys()
#CRP.apikey = keys.apikey
apikey = keys.apikey
# Remove the ones I don't need
import argparse
import json
import pprint
import sys
import urllib
import urllib2
import re
import string
import csv
import os
import pull


def findSenators():
	senators = []
	with open('data/114th.csv', 'rU') as csvfile:
		reader = csv.reader(csvfile)
		for row in reader:
			if row[4][0] == "S":
				candidate = {
				'cid': row[0],
				'first_name': row[1].split(',')[1],
				'last_name': row[1].split(',')[0],
				'party': row[2],
				'state': row[3][:2],
				'class': row[3][3], # class is because the elections are staggered
				'fec_id': row[4]
				}
				senators.append(candidate)
	return senators


#parse through stateSenators.json to get candidate IDs

#test record to continue working on parsing
x = {
  "WA": [
    {
      "state": "WA", 
      "name": " Maria Cantwell (D)", 
      "cid": "N00007836"
    }, 
    {
      "state": "WA", 
      "name": " Patty Murray (D)", 
      "cid": "N00007876"
    }
  ], 
  "DE": [
    {
      "state": "DE", 
      "name": " Tom Carper (D)", 
      "cid": "N00012508"
    }, 
    {
      "state": "DE", 
      "name": " Chris Coons (D)", 
      "cid": "N00031820"
    }
  ]
}





#function to go get/parse top industry contributors for a given senator
def getIndustryInfo(cid):
	industryOutput = []
	#get data from API 
	#not all of the congressman in the senators array have data as a response
	#will have to check if response is 404 or not before parsing data
	response = pull.callAPI("candIndustry", cid)

	#parse data
	industries = response['industries']['industry']
	for i in range(len(industries)):
		data = industries[i]['@attributes']
		ind = {
				'industry_code': data['industry_code'],
				'industry_name': data['industry_name'],
				'pacs': data['pacs'],
				'nonPAC' : data['indivs'],
				'total': data['total']
				}
		industryOutput.append(ind)


	return industryOutput

def writeIndustrydata():

	filepath = os.path.realpath('backend/data/stateSenators.json')
#	-- Open stateSenators json file (file does not open now for some reason)
	with open(filepath, 'r') as data_file:    
	    data = json.load(data_file)

	print data
	
	# data = {}
	# # -- Parse through data to collect cid's (x to be replaced by 'data')
	# for key in x:
	# 	sen1id = x[key][0]['cid']
	# 	sen2id = x[key][1]['cid']

	#  	sen1info = getIndustryInfo(sen1id)
	# 	sen2info = getIndustryInfo(sen2id)

	# 	data.update({sen1id, sen1info})
	# 	data.update({sen2id, sen2info})

	
	# # -- Write info to industryContrib file
	# data = str(json.dumps(data, indent=2))
	# with open("data/.json","w") as f:
	# 	f.write(data)

	return

writeIndustrydata()
